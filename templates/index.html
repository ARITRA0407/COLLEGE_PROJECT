<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>edVance - College Recommendation</title>

  <style>
    /* --- Defensive global reset to avoid horizontal overflow --- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow-x: hidden; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #f6f8fa; color: #1f2937; }

    /* Page wrapper: constrained layout */
    .page-wrap { width: 100%; padding: 12px; box-sizing: border-box; margin: 0 auto; }

    /* Explore full-width wrapper (escapes .page-wrap) */
    .explore-fullwidth {
      width: 100vw;               /* true viewport width */
      margin-left: calc(-50vw + 50%); /* break out of centered container */
      box-sizing: border-box;
    }

    /* Ensure recommendation partial doesn't blow out width */
    .container, .grid, .filters-row, .results-list, #results-area, #recommendation-form {
      width: 100% !important;
      max-width: 100% !important;
      overflow: visible;
      box-sizing: border-box;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    img, .college-img, .logo img, .results-list img {
      max-width: 100% !important;
      height: auto !important;
      display: block;
    }

    table, pre, code {
      max-width: 100% !important;
      overflow: auto;
      white-space: normal;
      word-break: break-word;
    }

    .iframe-wrap { width: 100%; background: #fff; border-radius: 10px; box-shadow: 0 8px 20px rgba(15,23,42,0.05); overflow: hidden; border: 1px solid #e6edf3; margin-top: 18px; }
    .comparison-iframe { width: 100%; height: 800px; border: 0; display: block; }

    .iframe-note { font-size:13px; color:#6b7280; padding:10px 12px; background:#fbfcfd; border-top:1px dashed #eef2f7; }

    canvas, .chart-card, .chart-wrapper {
      max-width: 100% !important;
      width: 100% !important;
      height: auto !important;
    }

    @media (max-width: 900px) {
      .comparison-iframe { height: 1200px; }
      .page-wrap { padding: 10px; }
      .explore-fullwidth { margin-left: 0; }
    }

    /* ---------- Added rules to ensure ai partial uses full available width and doesn't get cramped ---------- */
    /* Keep these very minimal and scoped so they don't affect other elements */
    .edv-ai-root {
      width: 100% !important;
      max-width: 1100px; /* allow wider chat on large screens but keep a readable line-length */
      margin: 16px auto !important;
      padding-left: 12px;
      padding-right: 12px;
      box-sizing: border-box;
    }
    .edv-ai-chat-wrap {
      width: 100% !important;
      max-width: 100% !important;
    }
    /* make the messages area use more vertical space on larger screens */
    @media (min-width: 1024px) {
      .edv-ai-chat-wrap { height: 680px !important; }
    }
    @media (max-width: 720px) {
      .edv-ai-root { padding-left: 8px; padding-right: 8px; }
      .edv-ai-chat-wrap { height: 520px !important; }
    }
    /* ----------------------------------------------------------------------------------------------- */

  </style>
</head>
<body>

  <div class="page-wrap">

    {% include 'partials/header.html' %}

    <div style="height:12px"></div>

    {% include 'partials/recommendation.html' %}

    <div style="height:18px"></div>

    <div class="iframe-wrap" aria-label="College comparison (isolated)">
      <iframe
        id="comparisonIframe"
        class="comparison-iframe"
        src="{{ url_for('comparison') }}"
        title="College Comparison"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
        allowfullscreen
      ></iframe>
    </div>

  </div> <!-- end .page-wrap -->

  <!-- Explore: break out to full width -->
  <div class="explore-fullwidth">
    {% include 'partials/explore.html' %}
    {% include 'partials/top.html' %}
  </div>
  {% include 'partials/ai.html' %}
  {% include 'partials/about.html' %}


  <div style="height:60px"></div>

  <script>
    (function(){
      const iframe = document.getElementById('comparisonIframe');
      window.addEventListener('message', (ev) => {
        const data = ev.data || {};
        if(data && data.type === 'comparison-height' && typeof data.height === 'number'){
          const h = Math.max(400, Math.min(3500, Math.round(data.height)));
          iframe.style.height = h + 'px';
        }
      }, false);

      iframe.addEventListener('load', () => {
        try {
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          const css = `*{box-sizing:border-box} .container, .grid, .panel, .comparison-panels, img, table, canvas { max-width:100% !important; width:100% !important; } img { height:auto !important; }`;
          const style = doc.createElement('style');
          style.appendChild(doc.createTextNode(css));
          doc.head && doc.head.appendChild(style);

          const autoH = Math.max(600, doc.documentElement.scrollHeight);
          iframe.style.height = autoH + 'px';
        } catch(e) {}
      });
    })();
  </script>

</body>
</html>
